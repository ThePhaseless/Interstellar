# =============================================================================
# AdGuard Home Services
# =============================================================================
# ClusterIP for internal access (ingress, other pods)
# LoadBalancer for LAN DNS access with real client IPs
# =============================================================================

# Internal ClusterIP for web UI (used by Ingress)
---
apiVersion: v1
kind: Service
metadata:
  name: adguard
  namespace: home
spec:
  type: ClusterIP
  ports:
    - name: http
      port: 3000
      targetPort: http
  selector:
    app: adguard

# LoadBalancer for LAN DNS access (MetalLB)
---
apiVersion: v1
kind: Service
metadata:
  name: adguard-dns
  namespace: home
  labels:
    app: adguard
  annotations:
    # Request a specific IP from MetalLB pool for stable DNS
    metallb.io/loadBalancerIPs: "10.0.0.53"
spec:
  type: LoadBalancer
  # Preserve real client IPs for per-device stats
  externalTrafficPolicy: Local
  selector:
    app: adguard
  ports:
    - name: dns-udp
      port: 53
      targetPort: dns-udp
      protocol: UDP
    - name: dns-tcp
      port: 53
      targetPort: dns-tcp
      protocol: TCP
