services:
  httpd:
    image: httpd:latest
    container_name: httpd
    ports:
      - "81:80"
    volumes:
      - ${CONFIG_PATH}/Home/httpd:/usr/local/apache2/htdocs
    restart: unless-stopped
    labels:
      - "traefik.http.routers.authelia.rule=HostRegexp(`{host:.+}`)"
      - "traefik.http.services.httpd.loadbalancer.server.port=80"

  homepage:
    image: ghcr.io/gethomepage/homepage:latest
    container_name: Homepage
    ports:
      - 82:3000
    volumes:
      - ./Homepage:/app/config
      - /var/run/docker.sock:/var/run/docker.sock
    restart: unless-stopped
    labels:
      - "traefik.http.routers.authelia.rule=HostRegexp(`{subdomain:home}.{host:.+}`)"
      - "traefik.http.services.homepage.loadbalancer.server.port=3000"
      - "traefik.http.routers.homepage.middlewares=authelia"

  duplicati:
    image: lscr.io/linuxserver/duplicati:latest
    container_name: duplicati
    environment:
      - TZ=${TIMEZONE}
      - CLI_ARGS= #optional
    volumes:
      - ${CONFIG_PATH}/Home/Duplicati:/config
      - /public:/source
    ports:
      - 8200:8200
    restart: unless-stopped
    labels:
      - "traefik.http.routers.duplicati.rule=HostRegexp(`{subdomain:backup}.{host:.+}`)"
      - "traefik.http.services.duplicati.loadbalancer.server.port=8200"
      - "traefik.http.routers.duplicati.middlewares=authelia"

  sggwbot:
    environment:
      - BOT_TOKEN=${BOT_TOKEN}
    restart: unless-stopped
    container_name: sggwbot
    image: thephaseless/sggwbot:main
    labels:
      - "traefik.enable=false"

  adguardhome:
    container_name: AdguardHome
    image: adguard/adguardhome
    restart: unless-stopped
    volumes:
      - "${CONFIG_PATH}/Home/AdGuard/work:/opt/adguardhome/work"
      - "${CONFIG_PATH}/Home/AdGuard/conf:/opt/adguardhome/conf"
    ports:
      - "84:80" # WebUI
      - "53:53" # DNS
      - "3000:3000/tcp" # Setup
    labels:
      - "traefik.http.routers.adguardhome.rule=HostRegexp(`{subdomain:adguard}.{host:.+}`)"
      - "traefik.http.services.adguardhome.loadbalancer.server.port=80"
      - "traefik.http.routers.adguardhome.middlewares=authelia"

  scanservjs:
    container_name: scanservjs
    image: "sbs20/scanservjs:latest"
    ports:
      - "84:8080"
    volumes:
      - "/var/run/dbus:/var/run/dbus"
      - "${MEDIA_PATH}/Scans:/app/data/output"
      - "${CONFIG_PATH}/Home/Scanservjs:/app/config"
    restart: unless-stopped
    devices:
      - "/dev/bus/usb:/dev/bus/usb"
    privileged: true
    labels:
      - "traefik.http.routers.scanservjs.rule=HostRegexp(`{subdomain:scan}.{host:.+}`)"
      - "traefik.http.services.scanservjs.loadbalancer.server.port=8080"
      - "traefik.http.routers.scanservjs.middlewares=authelia"

  gptwol:
    container_name: GPT-Wol
    image: misterbabou/gptwol:latest
    network_mode: host
    ports:
      - "85:85"
    restart: unless-stopped
    environment:
      - PORT=85 #Free Port on Your host default is 5000
      - TZ=${TIMEZONE}
    volumes:
      - ${CONFIG_PATH}/Home/GPTWol:/app
    labels:
      - "traefik.http.routers.gptwol.rule=HostRegexp(`{subdomain:wol}.{host:.+}`)"
      - "traefik.http.services.gptwol.loadbalancer.server.port=85"
      - "traefik.http.routers.gptwol.middlewares=authelia"
